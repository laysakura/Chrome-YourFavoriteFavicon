(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.9.2
(function(root, factory) {
  if (('function' === typeof define) && (define.amd != null)) {
    return define([], factory);
  } else if (typeof exports !== "undefined" && exports !== null) {
    return module.exports = factory();
  } else {
    return root.UrlPattern = factory();
  }
})(this, function() {
  var UrlPattern, alphanumericRegex;
  UrlPattern = function(arg) {
    if (arg instanceof UrlPattern) {
      this.isRegex = arg.isRegex;
      this.regex = arg.regex;
      this.names = arg.names;
      return this;
    }
    this.isRegex = arg instanceof RegExp;
    if (!(('string' === typeof arg) || this.isRegex)) {
      throw new TypeError('argument must be a regex or a string');
    }
    if (this.isRegex) {
      this.regex = arg;
    } else {
      this.compile(arg);
    }
    return this;
  };
  UrlPattern.prototype.match = function(url) {
    var bound, captured, i, j, len, match, name, value;
    match = this.regex.exec(url);
    if (match == null) {
      return null;
    }
    captured = match.slice(1);
    if (this.isRegex) {
      return captured;
    }
    bound = {};
    for (i = j = 0, len = captured.length; j < len; i = ++j) {
      value = captured[i];
      name = this.names[i];
      if (value == null) {
        continue;
      }
      if (bound[name] != null) {
        if (!Array.isArray(bound[name])) {
          bound[name] = [bound[name]];
        }
        bound[name].push(value);
      } else {
        bound[name] = value;
      }
    }
    return bound;
  };
  alphanumericRegex = new RegExp('^[a-zA-Z0-9]+$');
  UrlPattern.prototype.isAlphanumeric = function(string) {
    return alphanumericRegex.test(string);
  };
  UrlPattern.prototype.escapeForRegex = function(string) {
    return string.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
  };
  UrlPattern.prototype.compile = function(string) {
    var char, enter, index, leave, length, mode, names, openParens, regexString, sliceBegin, that;
    names = [];
    regexString = '^';
    mode = '?';
    sliceBegin = 0;
    openParens = 0;
    that = this;
    index = -1;
    leave = function() {
      switch (mode) {
        case 'variable':
          if ((index - sliceBegin) < 2) {
            throw new Error("`:` must be followed by at least one alphanumeric character that is the variable name at " + index);
          }
          names.push(string.slice(sliceBegin + 1, index));
          regexString += "([a-zA-Z0-9]+)";
          break;
        case 'static':
          regexString += that.escapeForRegex(string.slice(sliceBegin, index));
      }
      return mode = '?';
    };
    enter = function(nextMode) {
      if (nextMode === mode) {
        return;
      }
      leave();
      sliceBegin = index;
      return mode = nextMode;
    };
    length = string.length;
    while (++index < length) {
      char = string.charAt(index);
      if (char === ':') {
        if (mode === 'variable') {
          throw new Error("cannot start variable right after variable at " + index);
        }
        enter('variable');
      } else if (char === '(') {
        leave();
        openParens++;
        regexString += '(?:';
      } else if (char === ')') {
        leave();
        openParens--;
        if (openParens < 0) {
          throw new Error("did not expect ) at " + index);
        }
        regexString += ')?';
      } else if (char === '*') {
        leave();
        regexString += '(.*?)';
        names.push('_');
      } else {
        switch (mode) {
          case 'variable':
            if (!this.isAlphanumeric(char)) {
              enter('static');
            }
            break;
          case '?':
            enter('static');
        }
      }
    }
    if (openParens > 0) {
      throw new Error("unclosed parentheses at " + index);
    }
    leave();
    regexString += '$';
    this.names = names;
    return this.regex = new RegExp(regexString);
  };
  UrlPattern.newPattern = function() {
    throw Error('`urlPattern.newPattern` is no longer supported.  Use `new Pattern` instead.');
  };
  return UrlPattern;
});

},{}],2:[function(require,module,exports){
(function (global){
(function(global) {
  "use strict";

  // --- dependency modules ----------------------------------
  // --- define / local variables ----------------------------
  // --- class / interfaces ----------------------------------
  function YffCanvas(canvas) {
    this.canvas = canvas;
  }

  YffCanvas["prototype"]["drawSimple"] = drawSimple; // drawSimple(bgColor:String):void
  YffCanvas["prototype"]["drawImageDataUrl"] = drawImageDataUrl; // drawImageDataUrl(dataUrl:String):void

  // --- implements ------------------------------------------
  function drawSimple(bgColor) {
    var ctx = this.canvas.getContext('2d');
    ctx.fillStyle = bgColor;
    ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
  }

  function drawImageDataUrl(dataUrl) {
    var ctx = this.canvas.getContext('2d');
    var image = new Image();
    image.src = dataUrl;
    ctx.drawImage(image, 0, 0, this.canvas.width, this.canvas.height);
  }

  // --- exports ---------------------------------------------
  if (typeof module !== "undefined") {
    module["exports"] = YffCanvas;
  }
  global["YffCanvas"] = YffCanvas;

})((this || 0).self || global);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],3:[function(require,module,exports){
(function (global){
(function(global) {
  "use strict";

  // --- dependency modules ----------------------------------
  // --- define / local variables ----------------------------
  var YFF_CONST = {
    iconSize: 16,
    iconDataUrlFormat: 'image_png',
    iconLinkType: 'image/png',
    uploadImgTypePattern: /^image\/(png|jpeg|gif)$/,
  };

  // --- class / interfaces ----------------------------------
  // --- implements ------------------------------------------
  // --- exports ---------------------------------------------
  if (typeof module !== "undefined") {
    module["exports"] = YFF_CONST;
  }
  global["YFF_CONST"] = YFF_CONST;

})((this || 0).self || global);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],4:[function(require,module,exports){
(function (global){
(function(global) {
  "use strict";

  // --- dependency modules ----------------------------------
  // --- define / local variables ----------------------------
  var YffValidator = require("../viewModels/validator");

  // --- class / interfaces ----------------------------------

  // Model class of such object.
  //
  // {
  //   bgColor: "#a0f",
  // }
  function YffSimpleIcon() {}

  YffSimpleIcon["prototype"]["setAttributes"] = setAttributes; // setAttributes(attributes:Object):void, may throw YffValidationError

  // used as class method
  YffSimpleIcon["prototype"]["validateBgColor"] = validateBgColor; // validateBgColor(iconClass:String):String

  // --- implements ------------------------------------------
  function setAttributes(attributes) {
    this.bgColor = attributes.bgColor;
  }

  function validateBgColor(bgColor) {
    if (!YffValidator.prototype.isValidHtmlColorCode(bgColor)) {
      return "Valid color code is like #987 or #123abc";
    }
    return null;
  }

  // --- exports ---------------------------------------------
  if (typeof module !== "undefined") {
   module["exports"] = YffSimpleIcon;
  }
  global["YffSimpleIcon"] = YffSimpleIcon;

})((this || 0).self || global);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../viewModels/validator":8}],5:[function(require,module,exports){
(function (global){
(function(global) {
  "use strict";

  // --- dependency modules ----------------------------------
  var UrlPattern = require("url-pattern");

  // --- define / local variables ----------------------------
  // --- class / interfaces ----------------------------------

  // Model class of such object.
  //
  // {
  //   urlPattern: "*.example.jp",
  //   iconClass: "YffLocalImgIcon",  // One of "YffSimpleIcon", "YffLocalImgIcon"
  //   iconObject: <YffLocalImgIcon object>,  // One of <YffSimpleIcon object>, <YffLocalImgIcon object>
  // }
  function YffSiteIcon() {}

  YffSiteIcon["prototype"]["setAttributes"] = setAttributes; // setAttributes(attributes:Object):void, may throw YffValidationError

  // used as class method
  YffSiteIcon["prototype"]["validateUrlPattern"] = validateUrlPattern; // validateUrlPattern(urlPattern:String):String
  YffSiteIcon["prototype"]["validateIconClass"] = validateIconClass; // validateIconClass(iconClass:String):String

  // --- implements ------------------------------------------
  function setAttributes(attributes) {
    this.urlPattern = attributes.urlPattern;
    this.iconClass = attributes.iconClass;
    this.iconObject = attributes.iconObject;
  }

  function validateUrlPattern(urlPattern) {
    if (urlPattern.length == 0) { return "must not be empty"; }

    try { new UrlPattern(urlPattern); }
    catch (e) { return "Invalid URL pattern: " + e; }

    return null;
  }

  function validateIconClass(iconClass) {
    if (iconClass != "YffSimpleIcon") {
      return "" + iconClass + " is not a valid iconClass";
    }
    return null;
  }

  // --- exports ---------------------------------------------
  if (typeof module !== "undefined") {
   module["exports"] = YffSiteIcon;
  }
  global["YffSiteIcon"] = YffSiteIcon;

})((this || 0).self || global);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"url-pattern":1}],6:[function(require,module,exports){
(function() {
  "use strict";

  var YffValidator = require('./viewModels/validator');
  var optionsMain = require('./viewModels/options');

  $(window).load(optionsMain);
}());

},{"./viewModels/options":7,"./viewModels/validator":8}],7:[function(require,module,exports){
(function (global){
(function(global) {
  "use strict";

  // --- dependency modules ----------------------------------
  var YFF_CONST = require('../miscs/consts');
  var YffCanvas = require('../miscs/canvas');
  var YffValidator = require('../viewModels/validator');
  var YffSiteIcon = require('../models/siteIcon');
  var YffSimpleIcon = require('../models/simpleIcon');

  // --- define / local variables ----------------------------

  // --- class / interfaces ----------------------------------

  // --- implements ------------------------------------------
  function optionsMain() {
    var yffValidator = new YffValidator();

    var canvas = $('#yff_editing_icon_canvas')[0];
    canvas.width = YFF_CONST.iconSize;
    canvas.height = YFF_CONST.iconSize;

    var yffCanvas = new YffCanvas(canvas);

    registerDataBindings(yffCanvas);
    registerEventListners(yffCanvas, yffValidator);


    // 初期値はlocalStorageから(modelから)とる
    // これをform element操作でメモリ上で変更していく
    // var icon_setting = {
    //   iconFrom: 'simple',
    //   simple: {
    //     bg_color: '#0af',
    //     character: 'W',
    //   },
    //   localImg: {
    //     data_url: null,
    //   },
    // }

    //
    // Event listners (Controllers)
    $('#yff_register_btn').click(function() {
      // var iconFrom = ;

      chrome.storage.local.set(icon_setting, function() {
        console.log('setting has been saved.');
        console.log(icon_setting);
      });
    });
  }

  function registerDataBindings(yffCanvas) {
    var ViewModel = function() {
      var self = this;

      self.urlPattern = ko.observable("www.example.com");
      self.urlPatternValidationError = ko.observable();
      self.iconFrom = ko.observable("simple");
      self.bgColor = ko.observable("#abcdef");
      self.bgColorValidationError = ko.observable();

      self.urlPattern.subscribe(function(newUrlPattern) {
        var errorMessage = YffSiteIcon.prototype.validateUrlPattern(newUrlPattern);
console.log(errorMessage);
        self.urlPatternValidationError(errorMessage);
      });

      self.iconFrom.subscribe(function(newIconFrom) {
        $('.yff_fieldset').attr("disabled", true);
        $('#yff_fieldset_' + newIconFrom).attr("disabled", false);
      });

      self.bgColor.subscribe(function(newBgColor) {
        var errorMessage = YffSimpleIcon.prototype.validateBgColor(newBgColor);
        self.bgColorValidationError(errorMessage);
        if (errorMessage) { return; }

        drawPreviewSimple(yffCanvas, newBgColor);
      });
    };

    ko.applyBindings(new ViewModel());
  }

  function registerEventListners(yffCanvas, yffValidator) {
    $('#yffLocalImg').change(function() {
      var file = this.files[0];
      if (!yffValidator.isValidLocalImg(file)) return;

      console.log('Valid image file set:');

      var reader = new FileReader();
      reader.onload = function(e) {
        var data_url = e.target.result;
        console.log(data_url);

        // checks localStorage's limitation
        if (data_url.length > chrome.storage.sync.QUOTA_BYTES_PER_ITEM) {
          console.log('[FATAL] data_url too large');
          return;
        }

        // icon_setting.iconFrom = 'localImg';
        // icon_setting.localImg.data_url = data_url;

        yffCanvas.drawImageDataUrl(data_url);
      };
      reader.readAsDataURL(file);
    });
  }

  function drawPreviewSimple(yffCanvas, bgColor) {
    yffCanvas.drawSimple(bgColor);
  }

  // --- exports ---------------------------------------------
  if (typeof module !== "undefined") {
    module["exports"] = optionsMain;
  }
  global["optionsMain"] = optionsMain;

})((this || 0).self || global);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../miscs/canvas":2,"../miscs/consts":3,"../models/simpleIcon":4,"../models/siteIcon":5,"../viewModels/validator":8}],8:[function(require,module,exports){
(function (global){
(function(global) {
  "use strict";

  // --- dependency modules ----------------------------------
  var YFF_CONST = require("../miscs/consts");

  // --- define / local variables ----------------------------

  // --- class / interfaces ----------------------------------
  function YffValidator() {}

  YffValidator["prototype"]["isValidHtmlColorCode"] = isValidHtmlColorCode; // isValidHtmlColorCode(color:String):Boolean
  YffValidator["prototype"]["isValidLocalImg"] = isValidLocalImg; // isValidHtmlColorCode(localImg:Object):Boolean

  // --- implements ------------------------------------------
  function isValidHtmlColorCode(color) {
    return /^#[0-9a-f]{3}([0-9a-f]{3})?$/i.test(color);
  }

  function isValidLocalImg(localImg) {
    return localImg.type.match(YFF_CONST.uploadImgTypePattern);
  }

  // --- exports ---------------------------------------------
  if (typeof module !== "undefined") {
    module["exports"] = YffValidator;
  }
  global["YffValidator"] = YffValidator;

})((this || 0).self || global);

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../miscs/consts":3}]},{},[6]);
